import{i as m,br as f,r as l,m as h,q as g}from"./DjT8zhlV.js";import{d as v,N as S}from"./IoIuy_vt.js";import{d as A}from"./jGolgmb8.js";const T=m(()=>({theme:v,themeOverrides:{...S.darkTheme}})),i=A(["notification"],{configProviderProps:T}),I=f("auth",()=>{const a=g(),n=l(null);let u=JSON.parse(localStorage.getItem("authUser")||"{}");const r=l(localStorage.getItem("Bearer")||"");async function s(){const o=localStorage.getItem("Bearer")||"";let e={Accept:"application/json","Content-Type":"application/json"};o&&(e.Authorization=o);const t=await $fetch(a.public.apiURL+"auth/user",{method:"GET",credentials:"include",headers:e}).catch(c=>{i.notification.error({title:"Cannot login.",description:c.response.status+" "+c.response._data.message,duration:3e3,keepAliveOnHover:!0})});t&&(n.value=t,localStorage.setItem("authUser",JSON.stringify(t)))}async function p(o){await $fetch(a.public.rootURL+"sanctum/csrf-cookie",{method:"GET",credentials:"include"});const e=await $fetch(a.public.apiURL+"login",{method:"POST",body:o,credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).catch(t=>{i.notification.error({title:"Cannot login.",description:t.response.status+" "+t.response._data.message,duration:3e3,keepAliveOnHover:!0})});return e&&(r.value="Bearer "+e.token,localStorage.setItem("Bearer",r.value),await s()),e}async function d(){const o=localStorage.getItem("Bearer")||"";let e={Accept:"application/json","Content-Type":"application/json"};o&&(e.Authorization=o),await $fetch(a.public.apiURL+"auth/logout",{method:"POST",credentials:"include",headers:e}).catch(t=>{i.notification.error({title:"Cannot login.",description:t.response.status+" "+t.response._data.message,duration:3e3,keepAliveOnHover:!0})}),n.value=null,localStorage.removeItem("Bearer"),h("/")}return{user:n,login:p,fetchUser:s,logout:d,authUser:u}});export{I as u};
