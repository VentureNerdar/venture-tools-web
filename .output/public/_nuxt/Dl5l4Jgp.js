import{i as m,bs as f,r as i,m as h,q as g}from"./XhYJCJRV.js";import{d as v,N as S}from"./_qxj-Ane.js";import{d as A}from"./Caw8jftY.js";const T=m(()=>({theme:v,themeOverrides:{...S.darkTheme}})),r=A(["notification"],{configProviderProps:T}),I=f("auth",()=>{const a=g(),n=i(null);let s=i(JSON.parse(localStorage.getItem("authUser")||"{}"));const c=i(localStorage.getItem("Bearer")||"");async function l(){const o=localStorage.getItem("Bearer")||"";let t={Accept:"application/json","Content-Type":"application/json"};o&&(t.Authorization=o);const e=await $fetch(a.public.apiURL+"auth/user",{method:"GET",credentials:"include",headers:t}).catch(u=>{r.notification.error({title:"Cannot login.",description:u.response.status+" "+u.response._data.message,duration:3e3,keepAliveOnHover:!0})});e&&(n.value=e,s.value=e,localStorage.setItem("authUser",JSON.stringify(e)))}async function p(o){await $fetch(a.public.rootURL+"sanctum/csrf-cookie",{method:"GET",credentials:"include"});const t=await $fetch(a.public.apiURL+"login",{method:"POST",body:o,credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).catch(e=>{r.notification.error({title:"Cannot login.",description:e.response.status+" "+e.response._data.message,duration:3e3,keepAliveOnHover:!0})});return t&&(c.value="Bearer "+t.token,localStorage.setItem("Bearer",c.value),await l()),t}async function d(){const o=localStorage.getItem("Bearer")||"";let t={Accept:"application/json","Content-Type":"application/json"};o&&(t.Authorization=o),await $fetch(a.public.apiURL+"auth/logout",{method:"POST",credentials:"include",headers:t}).catch(e=>{r.notification.error({title:"Cannot login.",description:e.response.status+" "+e.response._data.message,duration:3e3,keepAliveOnHover:!0})}),n.value=null,localStorage.removeItem("Bearer"),h("/")}return{user:n,login:p,fetchUser:l,logout:d,authUser:s}});export{I as u};
