import{N as M,a as I}from"./ClgYNStd.js";import{D as S}from"./CyEnYTnN.js";import{d as k,r as v,j as U,h as w,P as O,G as T,v as C,L as F,B as _,y as N,A as u,M as e,O as D,_ as E,C as A,z as B,x as q,W as $}from"./DOkca_St.js";import{_ as P}from"./BT0IhlFl.js";import{_ as V}from"./B3iram_7.js";import{_ as z,a as j}from"./BzD9bC7z.js";import{R as x,u as R}from"./CpTWQXB8.js";import{u as W}from"./DXR9Wyph.js";import"./BLqpIeij.js";import"./B1aprbyB.js";import"./B9DHkmVn.js";import"./DU1_L8Zr.js";import"./Bk_rJcZu.js";import"./BCCRKTax.js";import"./Dh581del.js";import"./D4Rp5Yhg.js";const G={class:"notification-table"},H=k({__name:"Table",props:{data:{type:Array,required:!0,default:()=>[]}},emits:["row-click","delete-row"],setup(b,{emit:s}){const o=s,m=b,a=v([]),n=I(),d=U(()=>[{title:n.translate("title"),width:200,key:"title"},{title:n.translate("body"),width:300,key:"body"},{title:"",key:"actions",width:100,render(l){return w(O,{size:"small",type:"error",strong:!0,onClick:i=>{i.stopPropagation(),o("delete-row",l)}},{icon:()=>w(M,null,{default:()=>w(S)})})}}]),f=l=>({style:"cursor: pointer;",onClick:()=>{o("row-click",l)}});return T(()=>m.data,l=>{a.value=l}),(l,i)=>{const r=P,t=D;return C(),F(t,{size:"small",class:"container"},{default:_(()=>[N("div",G,[u(r,{columns:e(d),data:e(a),bordered:!1,pagination:!1,"row-props":f,"max-height":"calc(100vh - 304px)"},null,8,["columns","data"])])]),_:1})}}}),J=E(H,[["__scopeId","data-v-f728bfb1"]]),L=k({__name:"Form",props:{form:{type:Object,default:()=>({})}},emits:["update:form"],setup(b,{emit:s}){const o=b,m=s,a=I(),n=v({title:o.form.title,body:o.form.body}),d=v(null);T(()=>o.form,i=>{n.value.title=i.title,n.value.body=i.body},{deep:!0});const f={title:{required:!0,message:a.translate("title_is_required"),trigger:"blur"},body:{required:!0,message:a.translate("body_is_required"),trigger:"blur"}},l=i=>{var r;i.preventDefault(),(r=d.value)==null||r.validate(t=>{t||m("update:form",n.value)})};return(i,r)=>{const t=V,c=z,p=O,y=j,h=D;return C(),F(h,null,{default:_(()=>[u(y,{model:e(n),rules:f,ref_key:"formRef",ref:d},{default:_(()=>[u(c,{label:e(a).translate("title"),prop:"title",path:"title"},{default:_(()=>[u(t,{value:e(n).title,"onUpdate:value":r[0]||(r[0]=g=>e(n).title=g),placeholder:e(a).translate("please_input")},null,8,["value","placeholder"])]),_:1},8,["label"]),u(c,{label:e(a).translate("body"),prop:"body",path:"body"},{default:_(()=>[u(t,{value:e(n).body,"onUpdate:value":r[1]||(r[1]=g=>e(n).body=g),placeholder:e(a).translate("please_input")},null,8,["value","placeholder"])]),_:1},8,["label"]),u(c,null,{default:_(()=>[u(p,{type:"primary",onClick:l},{default:_(()=>[A(B(e(a).translate("send")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),K={class:"container"},Q={class:"form-container"},X=k({__name:"notifications",setup(b){const s=v({title:"",body:""}),o=v([]),m=W(),a=t=>{s.value.title=t.title,s.value.body=t.body},n=x.MOVEMENT_NOTIFICATIONS,d=R(n),f={all:!0,limit:20,where:JSON.stringify([{key:"user_id",value:m.authUser.id}])},l=async()=>{try{const t=await d.browse(f,!1);o.value=t,console.log(o.value)}catch(t){console.error("Error fetching notification:",t)}},i=async t=>{const c={...t,user_id:m.authUser.id};try{console.log("Form updated Final:",c);const p=await d.save(c);p&&(o.value.unshift(p),s.value={title:"",body:""})}catch(p){console.error("Error saving notification:",p)}},r=async t=>{console.log("Deleting row:",t),await R(x.MOVEMENT_NOTIFICATIONS,t.id).delete(!0)&&(o.value=o.value.filter(y=>y.id!==t.id))};return l(),(t,c)=>{const p=J,y=L;return C(),q("div",K,[N("div",null,[u(p,{data:e(o),onRowClick:a,onDeleteRow:r},null,8,["data"])]),N("div",Q,[u(y,{form:e(s),"onUpdate:form":[c[0]||(c[0]=h=>$(s)?s.value=h:null),i]},null,8,["form"])])])}}}),mt=E(X,[["__scopeId","data-v-e04ecca3"]]);export{mt as default};
